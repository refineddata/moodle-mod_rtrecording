define(["jquery","jqueryui"],function(a,b){return{init:function(){function b(b){a("input[name='typeisvideo']").val()||(a("#id_ajax_spin").remove(),a("#id_browse").after(' <span id="id_ajax_spin" class="rt-loading-image"></span>'),a.ajax({dataType:"json",url:window.wwwroot+"/mod/rtrecording/ajax/ajax.php",data:{action:"connect_get_sco_by_url",url:b}}).success(function(e){if(e.refined_noauth)a("#id_url").val(""),a("#id_name").val(""),d("danger",e.refined_noauth_message);else if(e.error)d("danger",e.error);else if("connect_not_update"==e.response){if("undefined"!=typeof M.str.connect.connect_not_update){var f=M.str.connect.typelistmeeting+M.str.connect.connect_not_update;d("danger",f)}}else if("no-data"==e.response||e.response.fixedurl){if(e.response.fixedurl&&(b=e.response.fixedurl),a("#id_url").val(b),"undefined"!=typeof M.str.connect.whensaved){var f=M.str.connect.notfound+M.str.connect.typelistmeeting+M.str.connect.whensaved;d("success",f)}else if("undefined"!=typeof M.str.connect.connect_not_update){var f=M.str.connect.notfound+M.str.connect.typelistmeeting+M.str.connect.connect_not_update;d("danger",f)}a("#id_name").removeClass("do-not-check")}else"archive"!=e.response.icon?(a("#id_url").val(""),a("#id_name").val(""),d("danger","Provided Url must be for a recording")):e.response.name?(a("#id_url").val(e.response.url.replace(/\//g,"")),a("#id_name").val(e.response.name).addClass("do-not-check"),"undefined"!=typeof tinymce?tinymce.get("id_introeditor").setContent(e.response.desc):a("#id_introeditoreditable").html(e.response.desc)):"denied"==e.response?(a("#id_url").val(""),d("danger","Access Denied, you do not have access to this url")):d("danger",e);c(b)}).done(function(){a("#id_ajax_spin").remove()}))}function c(b){a.ajax({dataType:"json",url:window.wwwroot+"/mod/rtrecording/ajax/ajax.php",data:{action:"connect_check_if_vp_recording",url:b}}).success(function(b){b.response?a("#id_detailgrading").attr("disabled",!1):(a("#id_detailgrading").val(0),a("#id_detailgrading").attr("disabled",!0),a("#fgroup_id_tg1").hide(),a("#fgroup_id_tg2").hide(),a("#fgroup_id_tg3").hide(),a("#fgroup_id_tg1vp").hide(),a("#fgroup_id_tg2vp").hide(),a("#fgroup_id_tg3vp").hide())})}function d(b,c){a("#fgroup_id_urlgrp_alert").remove(),a("#fgroup_id_urlgrp").after('<div class="fitem" id="fgroup_id_urlgrp_alert"><div class="felement fstatic alert alert-'+b+' alert-dismissible"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span></button>'+c+"</div></div>")}function e(){var b=a("#id_detailgrading").val();0==b?(a("#fgroup_id_tg1").hide(),a("#fgroup_id_tg2").hide(),a("#fgroup_id_tg3").hide(),a("#fgroup_id_tg1vp").hide(),a("#fgroup_id_tg2vp").hide(),a("#fgroup_id_tg3vp").hide()):1==b||2==b?(a("#fgroup_id_tg1").show(),a("#fgroup_id_tg2").show(),a("#fgroup_id_tg3").show(),a("#fgroup_id_tg1vp").hide(),a("#fgroup_id_tg2vp").hide(),a("#fgroup_id_tg3vp").hide()):3==b&&(a("#fgroup_id_tg1").hide(),a("#fgroup_id_tg2").hide(),a("#fgroup_id_tg3").hide(),a("#fgroup_id_tg1vp").show(),a("#fgroup_id_tg2vp").show(),a("#fgroup_id_tg3vp").show()),a("#fgroup_id_position_help_group").hide(),a("#fgroup_id_duration_help_group").hide(),a("#fgroup_id_vantage_help_group").hide(),1==b?a("#fgroup_id_position_help_group").show():2==b?a("#fgroup_id_duration_help_group").show():3==b&&a("#fgroup_id_vantage_help_group").show()}function f(){a("#id_start_enabled").is(":checked")?a("#id_remhdr").show():a("#id_remhdr").hide()}function g(){a("#id_start_enabled").is(":checked")?(a("#id_detailgrading").val(0),a("#id_detailgrading option[value=1]").hide()):a("#id_detailgrading option[value=1]").show()}a(document).ready(function(){!function(a,b){var c;return c=function(){function b(b,c,d){var e,f;e=a(b),f={root:"/",script:"/files/filetree",folderEvent:"click",expandSpeed:500,collapseSpeed:500,expandEasing:"swing",collapseEasing:"swing",multiFolder:!0,loadMessage:"Loading...",errorMessage:"Unable to get file tree information",multiSelect:!1,onlyFolders:!1,onlyFiles:!1},this.jqft={container:e},this.options=a.extend(f,c),this.callback=d,e.html('<ul class="jqueryFileTree start"><li class="wait">'+this.options.loadMessage+"<li></ul>"),this.showTree(e,escape(this.options.root))}return b.prototype.showTree=function(b,c){var d,e,f,g;return d=a(b),g=this.options,e=this,d.addClass("wait"),a(".jqueryFileTree.start").remove(),f={dir:c,onlyFolders:g.onlyFolders,onlyFiles:g.onlyFiles,multiSelect:g.multiSelect},a.ajax({url:g.script,type:"POST",dataType:"HTML",data:f}).done(function(b){var f;return d.find(".start").html(""),d.removeClass("wait").append(b),g.root===c?d.find("UL:hidden").show("undefined"!=typeof callback&&null!==callback):(void 0===jQuery.easing[g.expandEasing]&&(console.log("Easing library not loaded. Include jQueryUI or 3rd party lib."),g.expandEasing="swing"),d.find("UL:hidden").slideDown({duration:g.expandSpeed,easing:g.expandEasing})),f=a('[rel="'+decodeURIComponent(c)+'"]').parent(),g.multiSelect&&f.children("input").is(":checked")&&f.find("ul li input").each(function(){return a(this).prop("checked",!0),a(this).parent().addClass("selected")}),e.bindTree(d)}).fail(function(){return d.find(".start").html(""),d.removeClass("wait").append("<p>"+g.errorMessage+"</p>"),!1})},b.prototype.bindTree=function(b){var c,d,e,f,g,h;return c=a(b),g=this.options,f=this.jqft,d=this,e=this.callback,h=/^\/.*\/$/i,c.find("LI A").on(g.folderEvent,function(){var b,c;return b={},b.li=a(this).closest("li"),b.type=null!=(c=b.li.hasClass("directory"))?c:{directory:"file"},b.value=a(this).text(),b.rel=a(this).prop("rel"),b.container=f.container,a(this).parent().hasClass("directory")?a(this).parent().hasClass("collapsed")?(d._trigger(a(this),"filetreeexpand",b),g.multiFolder||(a(this).parent().parent().find("UL").slideUp({duration:g.collapseSpeed,easing:g.collapseEasing}),a(this).parent().parent().find("LI.directory").removeClass("expanded").addClass("collapsed")),a(this).parent().removeClass("collapsed").addClass("expanded"),a(this).parent().find("UL").remove(),d.showTree(a(this).parent(),a(this).attr("rel").match(h)[0]),d._trigger(a(this),"filetreeexpanded",b)):(d._trigger(a(this),"filetreecollapse",b),a(this).parent().find("UL").slideUp({duration:g.collapseSpeed,easing:g.collapseEasing}),a(this).parent().removeClass("expanded").addClass("collapsed"),d._trigger(a(this),"filetreecollapsed",b)):(g.multiSelect?a(this).parent().find("input").is(":checked")?(a(this).parent().find("input").prop("checked",!1),a(this).parent().removeClass("selected")):(a(this).parent().find("input").prop("checked",!0),a(this).parent().addClass("selected")):(f.container.find("li").removeClass("selected"),a(this).parent().addClass("selected")),d._trigger(a(this),"filetreeclicked",b),"function"==typeof e&&e(a(this).attr("rel"))),!1}),"click"!==g.folderEvent.toLowerCase?c.find("LI A").on("click",function(){return!1}):void 0},b.prototype._trigger=function(b,c,d){var e;return e=a(b),e.trigger(c,d)},b}(),a.fn.extend({fileTree:function(b,d){return this.each(function(){var e,f;return e=a(this),f=e.data("fileTree"),f||e.data("fileTree",f=new c(this,b,d)),"string"==typeof b?f[option].apply(f):void 0})}})}(a,window),a("#id_url").keyup(function(){var c=a(this).val();d(function(){b(c)},1e3)}),a("#id_url").blur(function(){var c=a(this).val();b(c)}),a("#id_browse").click(function(){var c=a("<div id='browseurl_window'></div>");c.fileTree({script:window.wwwroot+"/local/connect/ajax/jqueryFileTree.php",expandSpeed:1e3,collapseSpeed:1e3,multiFolder:!1},function(c){a("#browseurl_window").dialog("destroy"),a("#id_url").val(c),b(c)}).dialog({title:window.browsetitle,modal:!0,width:"80%",minHeight:450,height:450,resizable:!1}).dialog("open")});var d=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}();f(),g(),a("#id_start_enabled").change(function(){f(),g()}),e(),a("#id_detailgrading").change(function(){e()}),connectUrl=a("#id_url").val(),connectUrl&&c(connectUrl)}),a(document).ajaxComplete(function(){a("#browseurl_window .sco-folder").click(function(){var b=a(this).data("name"),c=a(this).data("scoid");a.ajax({url:window.wwwroot+"/mod/rtrecording/browseurl.php",data:{type:"meeting",name:b,scoid:c}}).success(function(b){a("#browseurl_window").html(b).dialog()})}),a("#browseurl_window .sco-breadcrumb").click(function(){var b=a(this).data("name"),c=a(this).data("scoid");a.ajax({url:window.wwwroot+"/mod/rtrecording/browseurl.php",data:{type:"meeting",name:b,scoid:c}}).success(function(b){a("#browseurl_window").html(b).dialog()})}),a("#browseurl_window .sco-choose").click(function(){var b=a(this).data("name"),c=a(this).data("scoid");a.ajax({url:window.wwwroot+"/mod/rtrecording/browseurl.php",data:{type:"meeting",name:b,scoid:c}}).success(function(b){a("#browseurl_window").html(b).dialog()})}),a("#browseurl_window .recording-choose").click(function(){var c=a(this).text();a("#browseurl_window").dialog("close"),a("#id_url").val(c),b(c)})})}}});